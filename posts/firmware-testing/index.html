<!DOCTYPE html>
<html lang="en-uk" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Using Github actions to simulate and test an FPGA Verilog design using Open Source tools">
<title>Continuous Integration for Firmware testing using Verilator</title>

<link rel='canonical' href='https://jjhorton.co.uk/posts/firmware-testing/'>

<link rel="stylesheet" href="/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css"><meta property='og:title' content="Continuous Integration for Firmware testing using Verilator">
<meta property='og:description' content="Using Github actions to simulate and test an FPGA Verilog design using Open Source tools">
<meta property='og:url' content='https://jjhorton.co.uk/posts/firmware-testing/'>
<meta property='og:site_name' content='James Horton'>
<meta property='og:type' content='article'><meta property='article:section' content='Posts' /><meta property='article:tag' content='Github' /><meta property='article:tag' content='CI' /><meta property='article:tag' content='Continuous Integration' /><meta property='article:tag' content='FPGA' /><meta property='article:tag' content='Verilog' /><meta property='article:published_time' content='2022-03-01T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-03-01T00:00:00&#43;00:00'/><meta property='og:image' content='https://jjhorton.co.uk/img/icebreaker.jpg' />
<meta name="twitter:site" content="@JamesjHorton">
    <meta name="twitter:creator" content="@JamesjHorton"><meta name="twitter:title" content="Continuous Integration for Firmware testing using Verilator">
<meta name="twitter:description" content="Using Github actions to simulate and test an FPGA Verilog design using Open Source tools"><meta name="twitter:card" content="summary">
    <meta name="twitter:image" content='https://jjhorton.co.uk/img/icebreaker.jpg' />
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-HS5DDLL3E1"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-HS5DDLL3E1');
        }
      </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/myavatar_hu_b2489b155b6de816.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">James Horton</a></h1>
            <h2 class="site-description">A selection of posts about my random projects at home, covering topics from Electronics to Software Defined Radio, and anything else I can think of</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/jjhorton'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/jjhorton/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <rect x="4" y="4" width="16" height="16" rx="2" />
  <line x1="8" y1="11" x2="8" y2="16" />
  <line x1="8" y1="8" x2="8" y2="8.01" />
  <line x1="12" y1="16" x2="12" y2="11" />
  <path d="M16 16v-3a2 2 0 0 0 -4 0" />
</svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/JamesjHorton'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/pages/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/posts/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archive</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    

            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/posts/firmware-testing/">
                
                    <img src="/img/icebreaker.jpg" loading="lazy" alt="Featured image of post Continuous Integration for Firmware testing using Verilator" />
                
            </a>
        </div>
    

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/firmware-testing/">Continuous Integration for Firmware testing using Verilator</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Using Github actions to simulate and test an FPGA Verilog design using Open Source tools
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 01, 2022</time>
            </div>
        

        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>I was looking to build a simple flashing LED example using my IceBreaker FPGA Board, for this I wanted to build on CI tools I set up before, and add some more useful testing to my setup. First of all lets look at what we are aiming to build, the PMOD board has 8 LED&rsquo;s each connected to a single pin, setting the IO pin high turns the LED on. With one LED on at a time, cycling though all the LED&rsquo;s one at a time at a speed which is easily slow enough to see. From this desription we can build up a picture of what we want our system to output.</p>
<figure><img src="https://svg.wavedrom.com/%7B%20%0A%20%27signal%27%3A%20%0A%20%09%5B%20%20%7B%20%20%20%0A%20%20%20%20%20%27name%27%3A%20%27CLK%27%20%20%20%20%2C%20%0A%20%20%20%20%20%27wave%27%3A%20%27P...............%27%20%7D%2C%0A%20%20%20%20%20%7B%7D%2C%20%20%0A%20%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%270%201%202%203%204%205%206%207%200%201%202%203%204%205%206%207%27%20%7D%2C%20%20%0A%20%20%20%20%20%7B%7D%2C%0A%20%20%20%20%20%0A%20%20%20%20%20%20%09%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%2701%2002%2004%2008%2010%2020%2040%2080%2001%2002%2004%2008%2010%2020%2040%2080%20%27%20%7D%2C%20%0A%20%20%20%20%20%09%7B%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B0%5D%27%2C%20%27wave%27%3A%20%27hl......hl......%27%20%7D%2C%0A%20%20%20%20%20%20%20%09%7B%20%27name%27%3A%20%27LED%5B1%5D%27%2C%20%27wave%27%3A%20%27lhl......hl.....%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B2%5D%27%2C%20%27wave%27%3A%20%27l.hl......hl....%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B3%5D%27%2C%20%27wave%27%3A%20%27l..hl......hl...%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B4%5D%27%2C%20%27wave%27%3A%20%27l...hl......hl..%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B5%5D%27%2C%20%27wave%27%3A%20%27l....hl......hl.%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B6%5D%27%2C%20%27wave%27%3A%20%27l.....hl......hl%27%20%7D%2C%0A%20%20%20%20%20%20%20%20%7B%20%27name%27%3A%20%27LED%5B7%5D%27%2C%20%27wave%27%3A%20%27l......hl......h%27%20%7D%2C%0A%20%20%20%0A%20%20%20%20%5D%0A%7D%0A%20">
</figure>

<p>The first task is to build up a clock divider, this takes in the clock that is avlible on our icebreaker board, and then creating a much slower clock. The clock on the iceBreaker FPGA is 12MHz, and we need to bring this down, the code bellow implements a counter in verilog which counts up to <code>1+2^23</code>. With this running at 12MHz should take the board ~0.7 seconds to count upto, this is a much better speed for the user to be able to see on the board, if we then trigger our code when the counter is reset.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="no">`default_nettype</span> <span class="n">none</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">module</span> <span class="n">blinky</span><span class="p">(</span><span class="n">CLK</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">input</span> 	<span class="kt">wire</span> 			<span class="n">CLK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">parameter</span> 	<span class="n">WIDTH</span><span class="o">=</span><span class="mh">25</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">reg</span> 	<span class="p">[</span><span class="n">WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>		<span class="n">counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">initial</span> <span class="n">counter</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">CLK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">begin</span>
</span></span><span class="line"><span class="cl">		<span class="n">counter</span> <span class="o">&lt;=</span> <span class="n">counter</span> <span class="o">+</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">begin</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// When the counter reaches top value reset it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">counter</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">end</span>
</span></span><span class="line"><span class="cl">	<span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>We can then setup the code to drive an LED, for this we are going to an an output LED, which is a an 8 bit output which will be mapped to the PMod connector. The display parameter is used to store the value that will disaplyed, this is initalised with a value of <code>8'b00000001</code> and then is binary shifted to the left each time the counter is reset, so after the first time the counter results in <code>8'b00000010</code>, and getting our required output, as the value it 8 bits wide once the value reaches <code>8'b10000000</code> it will wrap round to our origonally value, and start again from zero. The complete function is shown bellow.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="no">`default_nettype</span> <span class="n">none</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">module</span> <span class="n">blinky</span><span class="p">(</span><span class="n">CLK</span><span class="p">,</span> <span class="n">LED</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">input</span> 	<span class="kt">wire</span> 			<span class="n">CLK</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">output</span> 	<span class="kt">wire</span> 	<span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>	<span class="n">LED</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">parameter</span> 	<span class="n">WIDTH</span><span class="o">=</span><span class="mh">25</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">reg</span> 	<span class="p">[</span><span class="n">WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>		<span class="n">counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">reg</span> 	<span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>			<span class="n">display</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">initial</span> <span class="n">counter</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">initial</span> <span class="n">display</span> <span class="o">=</span> <span class="mh">8</span><span class="mb">&#39;b00000001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">CLK</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">begin</span>
</span></span><span class="line"><span class="cl">		<span class="n">counter</span> <span class="o">&lt;=</span> <span class="n">counter</span> <span class="o">+</span><span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">counter</span><span class="p">[</span><span class="n">WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">begin</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// When the counter reaches top value shift the LEd accross one
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">counter</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">display</span><span class="o">==</span> <span class="mh">8</span><span class="mb">&#39;b10000000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">display</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mb">&#39;b00000001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span>
</span></span><span class="line"><span class="cl">				<span class="n">display</span> <span class="o">&lt;=</span> <span class="n">display</span> <span class="o">&lt;&lt;</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">end</span>
</span></span><span class="line"><span class="cl">	<span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">assign</span> <span class="n">LED</span> <span class="o">=</span> <span class="n">display</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></div><p>With the code written the next plan is to test it, with a simple design like this it is easy to test on hardware but I was looking to use a simulation to help check everything is working, for this I&rsquo;m going to be using <a class="link" href="https://www.veripool.org/verilator/"  target="_blank" rel="noopener"
    >verilator</a>. The first check we can do is a lint check, this allows me to confirm that the syntax in my design is correct using verilator, without actually simulating our design:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">verilator --lint-only -cc blinky.v
</span></span></code></pre></div><p>Verilator also allows you to build test benches using C++ that drive your verilog design, this appeals to me as i&rsquo;ve been working with more <code>C</code> programming latley, so it works for me. Here is the code that I am using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;Vblinky.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;verilated_vcd_c.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;verilated.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">tick</span><span class="p">(</span><span class="kt">int</span> <span class="n">tickcount</span><span class="p">,</span> <span class="n">Vblinky</span> <span class="o">*</span><span class="n">tb</span><span class="p">,</span> <span class="n">VerilatedVcdC</span><span class="o">*</span> <span class="n">tfp</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="nf">eval</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">tfp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">tfp</span><span class="o">-&gt;</span><span class="nf">dump</span><span class="p">(</span><span class="n">tickcount</span> <span class="o">*</span> <span class="mi">10</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="n">CLK</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="nf">eval</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span><span class="p">(</span><span class="n">tfp</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">tfp</span><span class="o">-&gt;</span><span class="nf">dump</span><span class="p">(</span><span class="n">tickcount</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="n">CLK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="nf">eval</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">tfp</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">tfp</span><span class="o">-&gt;</span><span class="nf">dump</span><span class="p">(</span><span class="n">tickcount</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="mi">5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">tfp</span><span class="o">-&gt;</span><span class="nf">flush</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">	<span class="n">Verilated</span><span class="o">::</span><span class="nf">commandArgs</span><span class="p">(</span><span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Instantiate the design
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vblinky</span> <span class="o">*</span><span class="n">tb</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Vblinky</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">unsigned</span> <span class="n">tickcount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//generate a trace
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Verilated</span><span class="o">::</span><span class="nf">debug</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Verilated</span><span class="o">::</span><span class="nf">traceEverOn</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">VerilatedVcdC</span><span class="o">*</span> <span class="n">tfp</span> <span class="o">=</span> <span class="n">new</span> <span class="n">VerilatedVcdC</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Verilated</span><span class="o">::</span><span class="nf">mkdir</span><span class="p">(</span><span class="s">&#34;logs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">tb</span><span class="o">-&gt;</span><span class="nf">trace</span><span class="p">(</span><span class="n">tfp</span><span class="p">,</span> <span class="mi">99</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">tfp</span><span class="o">-&gt;</span><span class="nf">open</span><span class="p">(</span><span class="s">&#34;trace.vcd&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">8</span><span class="o">*</span><span class="mi">3</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">		<span class="nf">tick</span><span class="p">(</span><span class="o">++</span><span class="n">tickcount</span><span class="p">,</span> <span class="n">tb</span><span class="p">,</span> <span class="n">tfp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//write the coverage data out
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VerilatedCov</span><span class="o">::</span><span class="nf">write</span><span class="p">(</span><span class="s">&#34;logs/coverage.dat&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>There are two functions here, a <code>tick</code> function and the <code>main</code> function, the <code>main</code> function is were all the intresting stuff happens. The main function can be split into the following core functionality:</p>
<ul>
<li>Instantiate the compiled design with  <code>Vblinky *tb = new Vblinky;</code> which pulls our design as a C++ object from <code>Vblinky.h</code> which we imported at the start</li>
<li>We then initalise our tick counter, <code>unsigned tickcount = 0;</code> with this we count the number of clock cycles our design has completed</li>
<li>There are then a series of verilator settings that are set up, this are to provide out logging to a VCD file and output for coverage data</li>
<li>Next up is our main loop, <code>	for(int i=0; i&lt;(4*8*3); i++)</code> for each loop we are just running our tick function, <code>tick(++tickcount, tb, tfp);</code> this function creates the tick on the input.</li>
<li>Once the loop has created the number of clock cycles we need, we just write out the logged data with <code>VerilatedCov::write(&quot;logs/coverage.dat&quot;);</code> this is so we have some coverage data.</li>
</ul>
<p>With our program for testing our simple design, we now just need to run this code, but we need to run it with some specific inputs, and then run the resulting executable.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">verilator -Wall -GWIDTH<span class="o">=</span><span class="m">3</span> --trace --build --coverage -cc --exe blinky.v test.cpp
</span></span><span class="line"><span class="cl">./obj_dir/Vblinky
</span></span></code></pre></div><p>There are a few key flags that we are setting up here in the verilator command:</p>
<ul>
<li><code>-GWIDTH=3</code> This allows us to override the width parameter, in the case of this simulation we are reducing it from 25 in our design to 3 in the simulation, this is important to us, because otherwise in the example we would need to run a very long simulation where nothing happens for long periods. When what is needed in the simulation is to look at the transitions.</li>
<li><code>--trace</code> This allows the simulation to output the trace <code>vcd</code> file for our design, this will be how we confirm what is taking place inside our design.</li>
<li><code>--build</code> This tells verilator to build our test bench which is input as <code>test.cpp</code>, including compling our verilog design using verilator into the c++ object our test bench interacts with</li>
<li><code>--coverage</code> This tells verilator that we want to output the details for coverage, and it needs to keep those values</li>
</ul>
<p>With the last coverage command we also need to run another command to get the coverage data out in a useful format, such as html and in a text file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">verilator_coverage logs/coverage.dat --annotate logs/annotated --write-info logs/coverage.info --write logs/results.txt --rank
</span></span><span class="line"><span class="cl">genhtml logs/coverage.info --output-directory logs/html
</span></span><span class="line"><span class="cl">lcov --list logs/coverage.info &gt; logs/coverage.txt
</span></span></code></pre></div><p>This type of data is really useful for the CI tools, that I am setting up for this design. This is because the coverage gives an indication of how much of my verilog design is actually being tested in my test bench, in terms of how much of my code is actually being called. For this simple design the coverage stats are very simple and do not provide much insight, but confirm we are testing all of out design.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Reading tracefile logs/coverage.info
</span></span><span class="line"><span class="cl">            <span class="p">|</span>Lines       <span class="p">|</span>Functions  <span class="p">|</span>Branches    
</span></span><span class="line"><span class="cl">Filename    <span class="p">|</span>Rate     Num<span class="p">|</span>Rate    Num<span class="p">|</span>Rate     <span class="nv">Num</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>/<span class="o">]</span>
</span></span><span class="line"><span class="cl">blinky.v    <span class="p">|</span> 100%     15<span class="p">|</span>    -     0<span class="p">|</span>    -      <span class="nv">0</span>
</span></span><span class="line"><span class="cl"><span class="o">==================================================</span>
</span></span></code></pre></div><p>The next task is how we start to pull all these different components together into a Continuous Integration solution that can be run on each change to the repo. The setup for the <a class="link" href="https://github.com/features/actions"  target="_blank" rel="noopener"
    >Github action</a> for running these tests in very standard and I run on the ubuntu system.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;PMod LED&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">schedule</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0 8 * * 1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">paths</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;.github/workflows/Leds.yml&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s1">&#39;PMod_LED/Firmware/**&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">     
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">Build-Firmware</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout Code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">project</span><span class="w">
</span></span></span></code></pre></div><p>Installing verilator on the current version of ubuntu is an issue as I need a newer version, thankfully a version is avalible from the sifive <a class="link" href="https://github.com/sifive/verilator"  target="_blank" rel="noopener"
    >repo</a> for ubuntu, which can be installed once all the required depenancies are installed using apt, which is shown bellow.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Install verilator tools</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install git perl python3 make autoconf g++ flex bison ccache
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install libgoogle-perftools-dev numactl perl-doc
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install libfl2 
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install libfl-dev 
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install zlibc zlib1g zlib1g-dev
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo apt-get install lcov
</span></span></span><span class="line"><span class="cl"><span class="sd">          wget https://github.com/sifive/verilator/releases/download/4.204-0sifive3/verilator_4.204-0sifive3_amd64.deb
</span></span></span><span class="line"><span class="cl"><span class="sd">          sudo dpkg -i verilator_4.204-0sifive3_amd64.deb</span><span class="w">
</span></span></span></code></pre></div><p>Running the coverage base testing is the same as above, we just need to set the <code>VINC</code> veriiable before we start up</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Run coverage</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">project/PMod_LED/Firmware</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          export VINC=/usr/share/verilator/include
</span></span></span><span class="line"><span class="cl"><span class="sd">          verilator -Wall -GWIDTH=3 --trace --build --coverage -cc --exe $(PROJ).v test.cpp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="l">./obj_dir/Vblinky</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="l">verilator_coverage logs/coverage.dat --annotate logs/annotated --write-info logs/coverage.info --write logs/results.txt --rank</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="l">genhtml logs/coverage.info --output-directory logs/html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="l">lcov --list logs/coverage.info &gt; logs/coverage.txt</span><span class="w">
</span></span></span></code></pre></div><p>Now we have the outputs from out tests and coverage data we need to think about how we make that data avalible, for me this is completed by placing it in comments of a pull request, the first one to tackle is the <code>vcd</code> file that we created, now we needed to get it in a format that can be posted directly into the github pull request comments, for this I am using <a class="link" href="https://wavedrom.com/"  target="_blank" rel="noopener"
    >wavedrom</a> with its json wave formate, which is then rendered as an image in the comments. To get this done we need to convert from VCD to the specific json formate, as with most problems there is a solution avalible to make the conversion using a python script that <a class="link" href="https://github.com/nanamake"  target="_blank" rel="noopener"
    >someone else</a> has <a class="link" href="https://github.com/nanamake/vcd2json"  target="_blank" rel="noopener"
    >written</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Checkout vcd2json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">nanamake/vcd2json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">vcd2json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Generate plot of the waveform</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">project/PMod_LED/Firmware</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          sed -i &#39;/^$/d&#39; trace.vcd
</span></span></span><span class="line"><span class="cl"><span class="sd">          python3 generate_wave.py</span><span class="w">
</span></span></span></code></pre></div><p>This json waveform that is output can then be piped directly into a comment from the github action using just a few lines, we also add the coverage data at this point from the text file we created earlier.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Extract the test data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">project/PMod_LED/Firmware</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#39;Testing Output:&#39; &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo -n &#39;&lt;img src=&#34;https://svg.wavedrom.com/&#39; &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          sed -i &#34;s/\&#34;/&#39;/g&#34; trace.json
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#39;&#34;/&gt;&#39; &gt;&gt; trace.json
</span></span></span><span class="line"><span class="cl"><span class="sd">          cat trace.json | tr -d &#39;\n&#39; &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#39;Coverage Stats:&#39; &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#39;```&#39;  &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          cat logs/coverage.txt &gt;&gt; test-results.txt
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#39;```&#39;  &gt;&gt; test-results.txt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">comment test results in PR</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">if</span><span class="p">:</span><span class="w"> </span><span class="l">github.event.schedule != &#39;0 8 * * 1&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">machine-learning-apps/pr-comment@master</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">GITHUB_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.GITHUB_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">project/PMod_LED/Firmware/test-results.txt</span><span class="w">
</span></span></span></code></pre></div><p>The waveform that is added to the comment can be seen bellow along with the coverage data, this allows manual confirmation that the verilog code is behaving as expected without having to run the code on a local machine.</p>
<figure><img src="https://svg.wavedrom.com/%7B%20%27head%27%3A%20%7B%27tock%27%3A1%7D%2C%20%20%27signal%27%3A%20%5B%20%20%7B%20%20%20%27name%27%3A%20%27CLK%27%20%20%20%20%2C%20%27wave%27%3A%20%27p...................%27%20%7D%2C%20%20%7B%7D%2C%20%20%5B%2710%27%2C%20%20%20%20%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2701%2002%2004%2008%2010%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%271%202%203%204%200%201%202%203%204%200%201%202%203%204%200%201%202%203%204%200%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27display%27%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2700000001%2000000010%2000000100%2000001000%2000010000%27%20%7D%20%20%5D%2C%20%20%7B%7D%2C%20%20%5B%27210%27%2C%20%20%20%20%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2710%2020%2040%2080%2001%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%271%202%203%204%200%201%202%203%204%200%201%202%203%204%200%201%202%203%204%200%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27display%27%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2700010000%2000100000%2001000000%2010000000%2000000001%27%20%7D%20%20%5D%2C%20%20%7B%7D%2C%20%20%5B%27410%27%2C%20%20%20%20%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2701%2002%2004%2008%2010%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%271%202%203%204%200%201%202%203%204%200%201%202%203%204%200%201%202%203%204%200%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27display%27%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2700000001%2000000010%2000000100%2000001000%2000010000%27%20%7D%20%20%5D%2C%20%20%7B%7D%2C%20%20%5B%27610%27%2C%20%20%20%20%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2710%2020%2040%2080%2001%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%271%202%203%204%200%201%202%203%204%200%201%202%203%204%200%201%202%203%204%200%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27display%27%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2700010000%2000100000%2001000000%2010000000%2000000001%27%20%7D%20%20%5D%2C%20%20%7B%7D%2C%20%20%5B%27810%27%2C%20%20%20%20%7B%20%27name%27%3A%20%27LED%27%20%20%20%20%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2701%2002%2004%2008%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27counter%27%2C%20%27wave%27%3A%20%27%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%3D%27%2C%20%27data%27%3A%20%271%202%203%204%200%201%202%203%204%200%201%202%203%204%200%27%20%7D%2C%20%20%20%20%7B%20%27name%27%3A%20%27display%27%2C%20%27wave%27%3A%20%27%3D...%3D....%3D....%3D%27%2C%20%27data%27%3A%20%2700000001%2000000010%2000000100%2000001000%27%20%7D%20%20%5D%20%20%5D%7D">
</figure>

<p>While I do like this as a quick sanity check the inclusion of the code like this is only going to useful in a limited number of circumsances. Typically where a run is quick and it is easy to do a visual test, but I do like having it avalible on simple designs like this. The coverage information is more useful, as it allows tracking of testing performance, but this could be improved if we could add a comparision on the testing performance with the master branch for pull requests.</p>
<p><img src="/img/icebreaker_pmodled.jpg"
	
	
	
	loading="lazy"
	
		alt="IceBreaker FPGA Board with PMod LED Board"
	
	
></p>
<p>The next step is to look at adding some of the FPGA building features, that I created last year, although I would like to add some automatic stats like this for the FPGA build.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/github/">Github</a>
        
            <a href="/tags/ci/">CI</a>
        
            <a href="/tags/continuous-integration/">Continuous Integration</a>
        
            <a href="/tags/fpga/">FPGA</a>
        
            <a href="/tags/verilog/">Verilog</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/posts/fpga-build-stats/">
        
        
            <div class="article-image">
                
                    <img src="/img/colorlitei5.jpg" loading="lazy" data-key="" data-hash="/img/colorlitei5.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Adding FPGA build stats to Github Pull requests</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/posts/firmwareci/">
        
        
            <div class="article-image">
                
                    <img src="/img/colorlitei5.jpg" loading="lazy" data-key="" data-hash="/img/colorlitei5.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Continuous Integration for Firmware with Github Actions</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/posts/led_array_fpga/">
        
        
            <div class="article-image">
                
                    <img src="/img/LED_Array_FPGA_Complete.jpg" loading="lazy" data-key="" data-hash="/img/LED_Array_FPGA_Complete.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">PMod LED Array using with an FPGA </h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/posts/icesugarpro/">
        
        
            <div class="article-image">
                
                    <img src="/img/iCESugarpro-devboard.jpg" loading="lazy" data-key="" data-hash="/img/iCESugarpro-devboard.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Getting started with Ice Sugar Pro </h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2006 - 
        
        2025 James Horton
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
