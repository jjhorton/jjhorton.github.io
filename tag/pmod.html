<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>JJ Horton - PMod</title>
        <link rel="stylesheet" href="https://www.jjhorton.co.uk/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/jjhorton/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://www.jjhorton.co.uk/">JJ Horton </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/archives.html">Posts</a></li>
                    <li><a href="http://linkedin.com/in/jjhorton">CV</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.jjhorton.co.uk/christmas-countdown.html">Christmas Countdown</a></h1>
<footer class="post-info">
        <span>Fri 31 December 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/display.html">Display</a></span>
</footer><!-- /.post-info --><p><img src="images/ChristmasCountdown_Initial.jpg" width="350" ><div></p>
<p>Using my 7 segment display I wanted to build a Christmas countdown, this was just going to use the <a href="https://www.jjhorton.co.uk/seven-segment-display-pmod-board.html">PMod Display</a> that I had around, and then run from one of the <a href="https://github.com/jjhorton/Pico_Pmod">RP2040 boards</a> that I built earlier this year. As I wanted a count down that is frequently updating, I chose to use the countdown in seconds, as this for the month of December easily fits within the seven segments available.</p>
<p>The code that runs on the <a href="https://www.raspberrypi.com/products/rp2040/">RP2040</a> relies on a serial link as there is no real time clock on the <a href="https://github.com/jjhorton/Pico_Pmod">RP2040 boards</a>. We can also reuse some of the libraries that I use to drive the seven segment display, this means the main function is relatively simple, to run on the RP2040, which takes the count down calculated on a main computer and takes it from the serial link and puts it onto the display.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pico/stdlib.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pico/stdio_usb.h&quot;</span><span class="cp"></span>

<span class="c1">// Custom 7 Segment Display</span>
<span class="cp">#include</span> <span class="cpf">&quot;My7Seg.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//initalise the display</span>
    <span class="n">My7Seg</span> <span class="n">Display</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">Display</span><span class="p">.</span><span class="n">enable</span><span class="p">();</span>

    <span class="kt">int</span> <span class="n">seconds_left</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
    <span class="kt">char</span> <span class="n">countdown_str</span> <span class="p">[</span><span class="mi">8</span><span class="p">];</span>

    <span class="n">stdio_init_all</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Countdown Clock starting!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
    <span class="n">Display</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="mi">99999999</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>

    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">){</span>
        <span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">getchar_timeout_us</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;a&#39;</span><span class="p">){</span>

                <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">){</span>
                    <span class="n">buffer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">getchar_timeout_us</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="n">seconds_left</span> <span class="o">=</span> <span class="n">strtof</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">Display</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="kt">double</span><span class="p">(</span><span class="n">seconds_left</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The actually calculation of the number of seconds takes place on a <a href="https://www.raspberrypi.com/products/raspberry-pi-zero-w/">Raspberry Pi Zero</a>, this takes the current time which it gets from its Wifi Network connection, and then calculates the difference between the current time and the number of seconds until Christmas day, and sends it over the serial link to the <a href="https://github.com/jjhorton/Pico_Pmod">RP2040 Board</a>.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># /dev/tty.usbmodem1101 115200</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;/dev/tty.usbmodem1101&#39;</span><span class="p">)</span>  <span class="c1"># open serial port</span>
<span class="n">sio</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BufferedRWPair</span><span class="p">(</span><span class="n">ser</span><span class="p">,</span> <span class="n">ser</span><span class="p">))</span>

<span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">thisyear</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="n">year</span>
    <span class="n">xmas</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">thisyear</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">xmas</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">xmas</span> <span class="o">-</span> <span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">my_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">delta</span><span class="p">))</span>
    <span class="n">my_str</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

    <span class="n">sio</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">my_str</span><span class="p">)</span>
    <span class="n">sio</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">ser</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

<p><img src="images/ChristmasCountdown_OpenSCAD.jpg" width="350" ><div></p>
<p>With the main coding element taken care of the next task is building the case for the PCB's, I wanted to be able to mount the two boards together, and be able to attach the whole setup to my whiteboard, for the I created a simple case, which has holes in the back for placing some small magnets, and then holes in the front for mounting the PCB's on the front.</p>
<p><img src="images/ChristmasCountdown_CaseBack.jpg" width="350" ><div></p>
<p>This simple case provides an effective way of being mounted up on the Whiteboard, although now I am finally getting round to writing this all up, it is several days past Christmas so until next December it will have to wait until then, unless I can find a new date to countdown until.</p>
<p><img src="images/ChristmasCountdown_Zero.jpg" width="350" ><div></p>
<p>The code used to create this board, and the code for the case will be available <a href="https://github.com/jjhorton/RP2040_Countdown">here</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/seven-segment-display-pmod-board.html" rel="bookmark"
                           title="Permalink to Seven Segment Display PMod Board">Seven Segment Display PMod Board</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Tue 30 November 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/display.html">Display</a></span>
</footer><!-- /.post-info -->                <p>Building a PMod Based board to work with a 7 Segment Display</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/seven-segment-display-pmod-board.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/infrared-sensors-and-neopixel-screen.html" rel="bookmark"
                           title="Permalink to Infrared Sensors and Neopixel screen">Infrared Sensors and Neopixel screen</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Thu 30 September 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/fpga.html">FPGA</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a></span>
</footer><!-- /.post-info -->                <p>Hooking up the Infrared Sensor with a Neopixel based displays</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/infrared-sensors-and-neopixel-screen.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/rp2040-pmod-pcb.html" rel="bookmark"
                           title="Permalink to RP2040 PMod PCB">RP2040 PMod PCB</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Tue 31 August 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/rp2040.html">RP2040</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/fpga.html">FPGA</a></span>
</footer><!-- /.post-info -->                <p>Building a PMod Based board using a Raspberry Pi RP2040 microcontroller</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/rp2040-pmod-pcb.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/pmod-8x8-infrared-sensor.html" rel="bookmark"
                           title="Permalink to PMod 8x8 Infrared Sensor">PMod 8x8 Infrared Sensor</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Mon 12 July 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/fpga.html">FPGA</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a></span>
</footer><!-- /.post-info -->                <p>Building a PMod Based board with an 8x8 Infrared Sensor</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/pmod-8x8-infrared-sensor.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 2
        <a href="https://www.jjhorton.co.uk/tag/pmod2.html">&raquo;</a>
        <a href="https://www.jjhorton.co.uk/tag/pmod2.html">&#8649;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/jjhorton">Github</a></li>
                            <li><a href="http://twitter.com/jamesjhorton">Twitter</a></li>
                            <li><a href="http://linkedin.com/in/jjhorton">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59185025-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>