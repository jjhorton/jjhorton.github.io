<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>JJ Horton - Raspberry Pi</title>
        <link rel="stylesheet" href="https://www.jjhorton.co.uk/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/jjhorton/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://www.jjhorton.co.uk/">JJ Horton </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/archives.html">Posts</a></li>
                    <li><a href="http://linkedin.com/in/jjhorton">CV</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.jjhorton.co.uk/seven-segment-display-pmod-board.html">Seven Segment Display PMod Board</a></h1>
<footer class="post-info">
        <span>Tue 30 November 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/display.html">Display</a></span>
</footer><!-- /.post-info --><p>Ive always wanted to build a severn segment display, there is something about the old school style displays that it is hard to beat to display random numerical data like in <a href="https://www.thelegendofq.co.uk/encoder.html">the movies</a>.</p>
<p><img src="images/SevenSegment_bond_gps_encoder.png width="350"" ><div></p>
<p>The 7 Segment display that I decided to use, comes with 4 digits per display, and I was looking to combine two per PMod Board, with 8 LED per segment, we don't have enough pins to be able to control them all. An example of the maximum number of displays that can be controlled by a single PMod, is the display that I got with my <a href="https://www.crowdsupply.com/1bitsquared/icebreaker-fpga">iceBreaker FPGA</a> which has two digits, and removes the decimal point to allow multiplexing between the two displays.</p>
<p><img src="images/icebreaker-pmod-7-Segment.jpg" width="350 ><div></p>
<p>Thankfully there are a large number of solutions available to solve this problem, one of which are a range of dedicated chips controlled over a serial link to set seven segment displays.</p>
<p><img src="images/GN_Semic_GN1640.png" width="350 ><div></p>
<p>Devices such as the <a href="https://lcsc.com/product-detail/LED-Display-Drivers_GN-Semic-GN1640_C265478.html">GN Semic GN1640</a> which is the chip I decided to tag onto an order I was already placing at <a href="https://lcsc.com/product-detail/LED-Display-Drivers_GN-Semic-GN1640_C265478.html">LCSC Components</a>, at just £0.30 it seemed worth giving it a go. From what I had seen online these components were listed as being very similar to a number of other devices which are listed by other manufactures with similar part numbers such as TM1640, which appears to have a identical datasheet but with the advantage of being available in English.</p>
<p><img src="images/SevenSegment_schematic.png" width="350" ><div></p>
<p>The circuit for these <a href="https://lcsc.com/product-detail/LED-Display-Drivers_GN-Semic-GN1640_C265478.html">GN1640</a> chips is relatively simple, with just two input needing to come over the PMod connector, these are a clock signal and a data signal. The circuit for the Seven Segment displays is also relatively simple using a common cathode configuration, which matched my Seven Segment Displays I picked up from <a href="https://www.mouser.co.uk/ProductDetail/859-LTC-5723HR">Mouser</a>.</p>
<p><img src="images/SevenSegment_pcb.png" width="350"><div></p>
<p>The boards were laid out so that they would fit within the maximum 10x10cm limits of the <a href="https://jlcpcb.com">JLC PCB</a> 2 Layer PCB offer, the issue with this is that each of the displays was 5cm long, taking up the whole length of the PCB, but with all the control pins for the displays being in the centre of each display it was simple to mount the PCB with an overhang at one end leaving room for the PMod connector. The rest of the PCB is a simple 2 layer board, that was designed in KiCad.</p>
<p><img src="images/SevenSegment_complete.jpg" width="350"><div></p>
<p>With the PCB's made up, the next challenge was getting some software built up which allowed it to interface with one of my PMod Boards, to start with I used to the <a href="https://www.jjhorton.co.uk/rp2040-pmod-pcb.html">RP2040 PMod boards</a> that I had already made. This helps to simplify building up a simple example, as I can use a bit bashing approach to get a simple example.</p>
<p><img src="images/SevenSegment_TM1640-Timing.png" width="350"><div></p>
<p>The TM1640 Data Sheet provides a good description of the serial interface, so we can start to build up our functions to control the display, by setting the clk and serial pins either high or low, adding in the required delay as set out in the datasheets timing diagram.</p>
<div class="highlight"><pre><span></span>void enable()
{
            //command to turn on the display
            int command1[] = {1,1,1,1,0,0,0,1};
            //initallisation
            gpio_put(pin_data,0);
            sleep_ms(0.2);
            gpio_put(pin_clk,0);
            sleep_ms(0.2);
            //send the bits
            for(int i=0; i &lt; 8; ++i ){
                gpio_put(pin_data,command1[i]);
                sleep_ms(0.2);
                gpio_put(pin_clk,1);
                sleep_ms(0.4);
                gpio_put(pin_clk,0);
                sleep_ms(0.2);
            }
            //end the transmission
            gpio_put(pin_data,0);
            sleep_ms(0.2);
            gpio_put(pin_clk,1);
            sleep_ms(0.2);
            gpio_put(pin_data,1);

            sleep_ms(10);
}
</pre></div>

<p>With the display enabled I was then able to start sending data, this follows a similar design pattern with a function taking in the address and data, to trigger a series of short delays followed by setting the clock and data pins either high or low to transmit the data.  </p>
<div class="highlight"><pre><span></span>void txData(uint8_t pos, uint8_t data)
{
            uint8_t addr = 0b11000000 + pos;

            gpio_put(pin_data,0);
            sleep_ms(0.2);
            gpio_put(pin_clk,0);
            sleep_ms(0.2);

            for(int i=0; i &lt; 8; ++i ){
                gpio_put(pin_data,(addr &gt;&gt; i) &amp; 1U);
                sleep_ms(0.2);
                gpio_put(pin_clk,1);
                sleep_ms(0.4);
                gpio_put(pin_clk,0);
                sleep_ms(0.2);
            }

            for(int i=0 ; i &lt; 8; ++i ){
                gpio_put(pin_data,(data &gt;&gt; i) &amp; 1U);
                sleep_ms(0.2);
                gpio_put(pin_clk,1);
                sleep_ms(0.4);
                gpio_put(pin_clk,0);
                sleep_ms(0.2);
            }
            gpio_put(pin_data,0);
            sleep_ms(0.2);
            gpio_put(pin_clk,1);
            sleep_ms(0.2);
            gpio_put(pin_data,1);
}
</pre></div>

<p>The next challenge now I'm able to send data to the display using simple functions, is to look at turning the control functions into a C++ object, and then look at putting the display to a practical use. Another route to look at is setting up the PIO state machine to work with the display and possibly build a simple example that can also work with my <a href="https://www.crowdsupply.com/1bitsquared/icebreaker-fpga">Ice Breaker FPGA</a>.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/rp2040-pmod-pcb.html" rel="bookmark"
                           title="Permalink to RP2040 PMod PCB">RP2040 PMod PCB</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Tue 31 August 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/rp2040.html">RP2040</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/fpga.html">FPGA</a></span>
</footer><!-- /.post-info -->                <p>Building a PMod Based board using a Raspberry Pi RP2040 microcontroller</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/rp2040-pmod-pcb.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/pico-pmod-breakout-pcb.html" rel="bookmark"
                           title="Permalink to Pico PMod breakout PCB">Pico PMod breakout PCB</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Mon 31 May 2021</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">Raspberry Pi</a><a href="https://www.jjhorton.co.uk/tag/pico.html">Pico</a><a href="https://www.jjhorton.co.uk/tag/pmod.html">PMod</a><a href="https://www.jjhorton.co.uk/tag/fpga.html">FPGA</a></span>
</footer><!-- /.post-info -->                <p>Building a PMod Based board to the New Raspberry Pi Pico</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/pico-pmod-breakout-pcb.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/octave-on-my-raspberry-pi-cluster.html" rel="bookmark"
                           title="Permalink to Octave on my Raspberry Pi Cluster">Octave on my Raspberry Pi Cluster</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Thu 10 March 2016</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/cluster.html">cluster</a><a href="https://www.jjhorton.co.uk/tag/matlab.html">Matlab</a><a href="https://www.jjhorton.co.uk/tag/octave.html">octave</a><a href="https://www.jjhorton.co.uk/tag/pi.html">pi</a><a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">raspberry pi</a></span>
</footer><!-- /.post-info -->                <p>The main aim of building my Raspberry Pi Cluster was so that I could run
octave code on it, now I'm not expecting to break any records, but
ideally I want some performance. The best way I found to do this was
with the parallel's package.</p>
<p>With octave and the …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/octave-on-my-raspberry-pi-cluster.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/building-a-raspberry-pi-cluster.html" rel="bookmark"
                           title="Permalink to Building a Raspberry Pi Cluster">Building a Raspberry Pi Cluster</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Wed 02 March 2016</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/cluster.html">cluster</a><a href="https://www.jjhorton.co.uk/tag/matlab.html">Matlab</a><a href="https://www.jjhorton.co.uk/tag/octave.html">octave</a><a href="https://www.jjhorton.co.uk/tag/pi.html">pi</a><a href="https://www.jjhorton.co.uk/tag/raspberry-pi.html">raspberry pi</a></span>
</footer><!-- /.post-info -->                <p>I've had a long standing interest in Parallel Processing, and then a few months ago I came across Octave and its parallel package. Octave is very similar to MATLAB that I use every day, and for the most part basic MATLAB code works out of the box in Octave.</p>
<p>I …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/building-a-raspberry-pi-cluster.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 1
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/jjhorton">Github</a></li>
                            <li><a href="http://twitter.com/jamesjhorton">Twitter</a></li>
                            <li><a href="http://linkedin.com/in/jjhorton">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59185025-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>