<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>JJ Horton - Electronics</title>
        <link rel="stylesheet" href="https://www.jjhorton.co.uk/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/jjhorton/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://www.jjhorton.co.uk/">JJ Horton </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/archives.html">Posts</a></li>
                    <li><a href="http://linkedin.com/in/jjhorton">CV</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://www.jjhorton.co.uk/serial-communication-and-matlab.html">Serial Communication and MATLAB</a></h1>
<footer class="post-info">
        <span>Sun 15 April 2012</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/electronics.html">Electronics</a><a href="https://www.jjhorton.co.uk/tag/project.html">Project</a><a href="https://www.jjhorton.co.uk/tag/university.html">University</a></span>
</footer><!-- /.post-info --><p>For producing the Quad Rotor's GUI I needed to be able to implement the
serial communication in MATLAB. This it seemed would be a simple task as
on windows machines it is a simple task of opening the comms port, send
the data, and closing the port. All seemed so simple, but as it turns
out this was not the case on the Mac which I was using from my project
with MATLAB R2008a</p>
<div class="highlight"><pre><span></span>s = serial(&#39;/dev/tty.usbserial-FT4KIQ90&#39;);
fopen(s);
fprintf(s, &#39;a&#39;);
fclose(s);
</pre></div>

<p>I found that the serial interface on this version of MATLAB was not
fully implemented, as a result every time that you tried to close the
serial port you would need to restart the computer, which is far from
ideal. Luckily for me my university had just made available the latest
version of MATLAB (R2011a) which supported the serial communication
commands that I needed.</p>
<p>So how does the serial communication work? Well it all starts when the
user request the software to connect to the Quad Rotor, this checks to
see if the serial port is open or not, then if it is not it opens up the
serial link. This series of events first starts when the GUI is opened
up, at this point the serial object is created, with the parameters set
at this stage it allows the program to access it at any point though a
common interface. For the purpose of testing I am using a USB serial
connection in place of the bluetooth link, to prevent problems that
could be caused in the case of a communication failure. At this point
the BaudRate is set for the link, which is 115200, the same as used in
pervious tests, apart from this I user the standard settings for the
port.</p>
<div class="highlight"><pre><span></span>handles.s = serial(&#39;/dev/tty.usbserial-11BP0140&#39;);
handles.s.BaudRate = 115200;
</pre></div>

<p>Opening the connection, with the object no created it is possible to
connect to the Quad Rotor. This is done when the user selects the
Connect Button, which is names cmdConnect, and calls the function
bellow.</p>
<div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">---</span> <span class="nx">Executes</span> <span class="nx">on</span> <span class="nx">button</span> <span class="nx">press</span> <span class="k">in</span> <span class="nx">cmdConnect</span><span class="p">.</span>
<span class="kd">function</span> <span class="nx">cmdConnect_Callback</span><span class="p">(</span><span class="nx">hObject</span><span class="p">,</span> <span class="nx">eventdata</span><span class="p">,</span> <span class="nx">handles</span><span class="p">)</span>
<span class="o">%</span> <span class="nx">hObject</span> <span class="nx">handle</span> <span class="nx">to</span> <span class="nx">cmdConnect</span> <span class="p">(</span><span class="nx">see</span> <span class="nx">GCBO</span><span class="p">)</span>
<span class="o">%</span> <span class="nx">eventdata</span> <span class="nx">reserved</span> <span class="o">-</span> <span class="nx">to</span> <span class="nx">be</span> <span class="nx">defined</span> <span class="k">in</span> <span class="nx">a</span> <span class="nx">future</span> <span class="nx">version</span> <span class="nx">of</span> <span class="nx">MATLAB</span>
<span class="o">%</span> <span class="nx">handles</span> <span class="nx">structure</span> <span class="kd">with</span> <span class="nx">handles</span> <span class="nx">and</span> <span class="nx">user</span> <span class="nx">data</span> <span class="p">(</span><span class="nx">see</span> <span class="nx">GUIDATA</span><span class="p">)</span>

<span class="o">%</span><span class="nx">check</span> <span class="k">if</span> <span class="nx">the</span> <span class="nx">serial</span> <span class="nx">port</span> <span class="nx">is</span> <span class="nx">avalible</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">to</span>
<span class="k">if</span> <span class="nx">isa</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span><span class="s1">&#39;serial&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">isvalid</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">s</span><span class="p">)</span>
<span class="k">if</span> <span class="nx">strcmpi</span><span class="p">(</span><span class="nx">get</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span><span class="s1">&#39;Status&#39;</span><span class="p">),</span><span class="s1">&#39;open&#39;</span><span class="p">)</span>
<span class="nx">addstr</span> <span class="o">=</span> <span class="nx">cellstr</span><span class="p">(</span><span class="s1">&#39;Already Connected to Quadrotor&#39;</span><span class="p">);</span>
<span class="k">else</span>
<span class="nx">fopen</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">s</span><span class="p">);</span>
<span class="nx">addstr</span> <span class="o">=</span> <span class="nx">cellstr</span><span class="p">(</span><span class="s1">&#39;Connected to Quadrotor&#39;</span><span class="p">);</span>
<span class="nx">pause</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">end</span>
<span class="nx">commsStats</span> <span class="o">=</span> <span class="s1">&#39;Connected to Quadrotor&#39;</span><span class="p">;</span>
<span class="o">%</span><span class="nx">set</span> <span class="nx">the</span> <span class="nx">enabled</span> <span class="nx">buttons</span>
<span class="nx">set</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">cmdDisconnect</span><span class="p">,</span> <span class="s1">&#39;Enable&#39;</span><span class="p">,</span> <span class="s1">&#39;on&#39;</span><span class="p">);</span>
<span class="nx">set</span><span class="p">(</span><span class="nx">handles</span><span class="p">.</span><span class="nx">cmdConnect</span><span class="p">,</span> <span class="s1">&#39;Enable , &#39;</span><span class="nx">off</span><span class="s1">&#39;);</span>

<span class="s1">else</span>
<span class="s1">addstr = cellstr(&#39;</span><span class="nx">Failed</span> <span class="nx">to</span> <span class="nx">connect</span> <span class="nx">to</span> <span class="nx">quadrotor</span><span class="s1">&#39;);</span>
<span class="s1">commsStats = &#39;</span><span class="nx">Disconnected</span> <span class="nx">from</span> <span class="nx">Quadrotor</span><span class="s1">&#39;;</span>
<span class="s1">end</span>

<span class="s1">%add the log update to the gui</span>
<span class="s1">oldstr = cellstr(get(handles.lbDataveiw, &#39;</span><span class="nb">String</span><span class="s1">&#39;));</span>
<span class="s1">set(handles.lbDataveiw, &#39;</span><span class="nx">str</span><span class="s1">&#39;, { addstr{:} ,oldstr{:} });</span>
<span class="s1">%set(handles.tbComms, &#39;</span><span class="nx">str</span><span class="s1">&#39;, commsStats);</span>
<span class="s1">set( handles.tbComms, &#39;</span><span class="nb">String</span><span class="err">&#39;</span><span class="p">,</span> <span class="nx">commsStats</span> <span class="p">);</span>
<span class="nx">end</span>
</pre></div>

<p>This function carries out a few simple error checks to ensure that the
program only calls the function that opens the COM port at the right
time, otherwise MATLAB and GUI could crash. It first checks that the
serial port object has been created, and if it is valid. This allows the
confirmation of if the serial port exists, as the Quad Rotor may not
have power, be disconnected from the setup, or the port is in use by
another program, in this case it reports to the user about the failure,
by adding a new cell to the text reporting system in the GUI.</p>
<p>Now that it confirmed that the port exists it checks if the port is
actually open or not, using the following code, which comes back with a
true or false statement which is used as part of an If statement.</p>
<div class="highlight"><pre><span></span>strcmpi(get(handles.s,&#39;Status&#39;),&#39;open&#39;)
</pre></div>

<p>If the port is already open it again reports this to the user, but if
all the details are correct then it is able to open the connection to
the Aurdino Microcontroller on board the quad rotor.</p>
<p>The next stage in the system is sending data to the Aurdino
Microcontroller, and receiving it back. This is relatively straight
forward, to send the data, For example to request a communication link
test:</p>
<div class="highlight"><pre><span></span>fprintf(handles.s, &#39;t&#39;);
</pre></div>

<p>And then to receive the data that is send back we use:</p>
<div class="highlight"><pre><span></span>testresult = fscanf(handles.s);
</pre></div>

<p>The next stage on the process, is now to close the serial port. This is
important to free it us for use with other programs, and ensure we are
able to connect to it again when the program is next started up. The
port can simply closed using the following command, which closes the
connection:</p>
<div class="highlight"><pre><span></span>fclose(handles.s);
</pre></div>

<p>In my case this is called when we click on the Disconnect button in the
GUI. Next thing to do on the project now is automating the process of
sending an receiving this data.</p>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/communication-control.html" rel="bookmark"
                           title="Permalink to Communication Control">Communication Control</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Mon 09 April 2012</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/electronics.html">Electronics</a><a href="https://www.jjhorton.co.uk/tag/project.html">Project</a><a href="https://www.jjhorton.co.uk/tag/uncategorized.html">Uncategorized</a><a href="https://www.jjhorton.co.uk/tag/university.html">University</a></span>
</footer><!-- /.post-info -->                <p>For the Quad rotor to work I need some control over it, I have got my
<a href="http://jjhorton.co.uk/archives/67">communications link</a> all set up, but
I need to sort out what I'm going to send over it. Previously I had just
been sending gyroscope or accelerometer readings, but now this needs to
become …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/communication-control.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/getting-the-rotors-running.html" rel="bookmark"
                           title="Permalink to Getting the Rotors Running">Getting the Rotors Running</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Thu 05 April 2012</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/electronics.html">Electronics</a><a href="https://www.jjhorton.co.uk/tag/project.html">Project</a><a href="https://www.jjhorton.co.uk/tag/university.html">University</a></span>
</footer><!-- /.post-info -->                <p>After several weeks off nothing happening, then hitting problems with
the filtering i've finally found sometime to get some work done on my
project. This week I have been getting the rotors running, which is
surprisingly simple no that I know how it all works.</p>
<p>With my project being based …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/getting-the-rotors-running.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/communication.html" rel="bookmark"
                           title="Permalink to Communication">Communication</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Fri 17 February 2012</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/bluetooth.html">Bluetooth</a><a href="https://www.jjhorton.co.uk/tag/electronics.html">electronics</a><a href="https://www.jjhorton.co.uk/tag/level-3.html">Level 3</a><a href="https://www.jjhorton.co.uk/tag/project.html">Project</a><a href="https://www.jjhorton.co.uk/tag/quadrotor.html">Quadrotor</a></span>
</footer><!-- /.post-info -->                <p>For the communication system, there are many choices available from the
traditional route of model building and control. The main issue with
these systems is that they are very expensive, so for my project I have
chosen to use a Bluetooth module.</p>
<p><img src="images/BluetoothPcb.png" width="350"><div></p>
<p>The module that I have chosen is the …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/communication.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://www.jjhorton.co.uk/processing-power.html" rel="bookmark"
                           title="Permalink to Processing Power">Processing Power</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <span>Fri 17 February 2012</span>
<span>| tags: <a href="https://www.jjhorton.co.uk/tag/arduino.html">Arduino</a><a href="https://www.jjhorton.co.uk/tag/electronics.html">Electronics</a><a href="https://www.jjhorton.co.uk/tag/level-3.html">Level 3</a><a href="https://www.jjhorton.co.uk/tag/processor.html">Processor</a><a href="https://www.jjhorton.co.uk/tag/project.html">Project</a><a href="https://www.jjhorton.co.uk/tag/quadrotor.html">Quadrotor</a></span>
</footer><!-- /.post-info -->                <p>To get everything talking together I’m going to need something to sit in
the middle, and provide all the processing power. On the recommendation
of my supervisor I had a look at the arduino boards. The arduino boards
are based on Atmel processors in the middle with a boot …</p>
                <a class="readmore" href="https://www.jjhorton.co.uk/processing-power.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
            </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 2
        <a href="https://www.jjhorton.co.uk/tag/electronics2.html">&raquo;</a>
        <a href="https://www.jjhorton.co.uk/tag/electronics2.html">&#8649;</a>
</p>
            </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/jjhorton">Github</a></li>
                            <li><a href="http://twitter.com/jamesjhorton">Twitter</a></li>
                            <li><a href="http://linkedin.com/in/jjhorton">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59185025-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>