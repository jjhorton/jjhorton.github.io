<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Getting the Rotors Running</title>
        <link rel="stylesheet" href="http://jjhorton.co.uk/theme/css/main.css" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/jjhorton/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="http://jjhorton.co.uk/">JJ Horton </a></h1>
                <nav><ul>
                    <li><a href="/pages/about.html">About</a></li>
                    <li><a href="/archives.html">Posts</a></li>
                    <li><a href="http://linkedin.com/in/jjhorton">CV</a></li>
                </ul>
                </nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="http://jjhorton.co.uk/getting-the-rotors-running.html" rel="bookmark"
           title="Permalink to Getting the Rotors Running">Getting the Rotors Running</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <span>Thu 05 April 2012</span>
<span>| tags: <a href="http://jjhorton.co.uk/tag/electronics.html">Electronics</a><a href="http://jjhorton.co.uk/tag/project.html">Project</a><a href="http://jjhorton.co.uk/tag/university.html">University</a></span>
</footer><!-- /.post-info -->      <p>After several weeks off nothing happening, then hitting problems with
the filtering i've finally found sometime to get some work done on my
project. This week I have been getting the rotors running, which is
surprisingly simple no that I know how it all works.</p>
<p>With my project being based on an Arduino Nano processor I was able to
use the <a href="http://arduino.cc/en/Reference/Servo">Servo Library</a>, although
this is mainly aimed at controlling servo's it also works for ESC's.
This allows me to comunicate to the servo's using a simplified
interface, not having to worry about the interrupts, and timing cycles.
This does come at the cost of code size ad run speed, but if this
becomes a problem I can always go back and take another look at it.</p>
<p><img src="images/Quadcopter_rotortest.jpg" width="350"><div></p>
<p>The code I created uses 3 main functions, with another one for testing,
these functions are:</p>
<ul>
<li>initRotor - This function initiales the servos, and sets an initial
    value off zero.</li>
<li>rotorSet - This function takes the 4 integer values representing the
    rotor speeds and sets each off the rotors to them.</li>
<li>rotorStop - This is used to stop the rotors, I may remove this
    function but has been useful in testing when it all goes wrong.</li>
<li>rotorTest - This has been mainly used for testing, running each
    rotor up for a short period of time individually before starting the
    next, again this will probably be removed from the final code .</li>
</ul>
<p>The code is shown here, although its very simple</p>
<div class="highlight"><pre><span></span>//the code to control the rotor speeds
#include    Servo.h;

Servo rotor1;
Servo rotor2;
Servo rotor3;
Servo rotor4;

void initRotor() {
    //attach the servos, to stop them from beeping
    rotor1.attach(3);
    rotor2.attach(5);
    rotor3.attach(6);
    rotor4.attach(10);
    //This will then set all the rotors to zero rotorSet(0, 0, 0, 0);
}
void rotorSet(int speed1, int speed2, int speed3, int speed4) {
    //speed values must be given as 0-1000, to update power
    rotor1.writeMicroseconds(speed1 + 1000);
    rotor2.writeMicroseconds(speed2 + 1000);
    rotor3.writeMicroseconds(speed3 + 1000);
    rotor4.writeMicroseconds(speed4 + 1000);
}

void rotorStop() {
    //this function stops al the rotors
    rotor1.writeMicroseconds(700);
    rotor2.writeMicroseconds(700);
    rotor3.writeMicroseconds(700);
    rotor4.writeMicroseconds(700);
}
</pre></div>

<p>The code is mainly driven by the writeMicroseconds operation off the
servo object, this allows for the updating off the servo pulse width,
which is normally defined as between 1000 and 2000 Micro Seconds,
representing the minimum and maximum output respectively from the ESC
that they will drive. The reason that the stop function uses the lower
value off 700, is to ensure that it falls outside the tolerances off the
ESC timing preventing any movement from the rotors.</p>
<p>These 4 functions provide all the required functionality that my quad
rotor will need for this project. The big tasks that I hope to get done
in the next week include the filtering, and the PID control so I should
soon have this quad rotor off the ground.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="http://github.com/jjhorton">Github</a></li>
                            <li><a href="http://twitter.com/jamesjhorton">Twitter</a></li>
                            <li><a href="http://linkedin.com/in/jjhorton">LinkedIn</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme <a href="https://github.com/blueicefield/pelican-blueidea/">blueidea</a>, inspired by the default theme.</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-59185025-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>